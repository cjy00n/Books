# 스코프의 종류

- 코드는 `전역(global)`과 `지역(local)`으로 구분할 수 있다.

<img src="https://velog.velcdn.com/images/gyeongmi_lee/post/bf37ac97-d454-4960-b0de-c33ada20a38b/image.png" width="400">

- 이때 변수는 자신이 선언된 위치(전역 또는 지역)에 의해 자신이 유효한 범위인 스코프가 결정된다.
- 즉, 전역에서 선언된 변수는 전역 스코프를 갖는 `전역 변수`이고, 지역에서 선언된 변수는 지역 스코프를 갖는 `지역 변수`이다.

## 전역과 전역 스코프

<img src="https://velog.velcdn.com/images/gyeongmi_lee/post/6f91e0de-3305-4e67-8d1c-e1b7fbc0bc51/image.png" width="500">

- `전역` 이란 코드의 가장 바깥 영역을 말한다. 전역은 `전역 스코프`를 만든다.
- 전역에 변수를 선언하면 전역 스코프를 갖는 전역 변수가 된다.
- 전역 변수는 어디서든지 참조할 수 있다.

## 지역과 지역 스코프

- `지역`이란 함수 몸체 내부를 말한다.
- 지역은 `지역 스코프`를 만든다.
- 지역에 변수를 선언하면 지역 스코프를 갖는 지역 변수가 된다.
- 지역 변수는 자신이 선언된 지역과 하위지역(중첩 함수)에서만 참조할 수 있다.
- 다시 말해, **지역 변수는 자신의 지역 스코프와 하위 지역 스코프에서 유효하다.**

# 스코프 체인

- 함수는 전역에서 정의할 수도 있고 함수 몸체 내부에서 정의할 수도 있다.
- 함수 몸체 내부에서 함수가 정의된 것을 `함수의 중첩`이라 한다.
- 함수 몸체 내부에서 정의한 함수를 `중첩 함수`, 중첩 함수를 포함하는 함수를 `외부 함수`라고 한다.

- 함수는 중첩될 수 있으므로 함수의 지역 스코프도 중첩될 수 있다.
- 이는 **스코프가 함수의 중첩에 의해 `계층적 구조`를 갖는다는 것을 의미한다.**
- 중첩 함수의 지역 스코프는 중첩 함수를 포함하는 외부 함수의 지역 스코프와 계층적 구조를 갖는다.
- 외부 함수의 지역 스코프를 중첩 함수의 `상위 스코프`라 한다.

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbeayI1%2Fbtr7NQKkcQ9%2FTQ8UjG1MV3T4rwAWnT9jtk%2Fimg.png" width="200">

- 이처럼 모든 스코프는 하나의 계층적 구조로 연결되며, 모든 지역 스코프의 최상위 스코프는 전역 스코프다.
- 이렇게 스코프가 계층적으로 연결된 것을 `스코프 체인`이라고 한다.
- **변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색**한다.
- 이를 통해 상위 스코프에서 선언한 변수를 하위 스코프에서도 참조할 수 있다.

- 스코프 체인은 물리적인 실체로 존재한다.
- `자바스크립트 엔진`은 코드(전역 코드와 함수 코드)를 실행하기에 앞서 위 그림과 유사한 자료구조인 `렉시컬 환경`을 실제로 생성한다.
- 변수 선언이 실행되면 변수 식별자가 이 `자료구조(렉시컬 환경)`에 `키(key)`로 등록되고, 변수 할당이 일어나면 이 자료구조의 변수 식별자에 해당하는 값을 변경한다.
- 변수의 검색도 이 자료구조 상에서 이뤄진다.

> **렉시컬 환경**
> 스코프 체인은 실행 컨텍스트의 렉시컬 환경을 단방향으로 연결한 것이다.
> 전역 렉시컬 환경은 코드가 로드되면 곧바로 생성되고, 함수의 렉시컬 환경은 함수가 호출되면 곧바로 생성된다.

## 스코프 체인에 의한 변수 검색

- 자바스크립트 엔진은 스코프 체인을 따라 변수를 참조하는 코드의 스코프에서 시작해서 상위 스코프 방향으로 이동하며 선언된 변수를 검색한다.
- 절대 하위 스코프로 내려가면서 식별자를 검색하는 일은 없다.
- **상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조할 수 있지만 하위 스코프에서 유효한 변수를 상위 스코프에서 참조할 수 없다**는 것을 의미한다.

- 스코프 체인으로 연결된 스코프의 계층적 구조는 부자 관계로 이뤄진 `상속`과 유사하다.
- 상속을 통해 부모의 자산을 자식이 자유롭게 사용할 수 있지만, 자식의 자산을 부모가 사용할 수는 없다.
- 스코프 체인도 마찬가지 개념이다.

## 스코프 체인에 의한 함수 검색

```jsx
// 예제 13-06

function foo() {
  console.log("global function foo");
}

function bar() {
  // 중첩 함수
  function foo() {
    console.log("local function foo");
  }
  foo(); // ①
}

bar();
```

- 함수 선언문으로 함수를 정의하면 런타임 이전에 함수 객체가 먼저 생성된다.
- 그리고 자바스크립트 엔진은 함수 이름과 동일한 이름의 식별자를 암묵적으로 선언하고 생성된 함수 객체를 할당한다.

- 따라서 위 예제의 모든 함수는 함수 이름과 동일한 이름의 식별자에 할당된다.
- ①에서 foo 함수를 호출하면 자바스크립트 엔진은 함수를 호출하기 위해 먼저 함수를 가리키는 식별자 foo를 검색한다.

- 이처럼 함수도 식별자에 할당되기 때문에 스코프를 갖는다.
- 사실 함수는 식별자에 함수 객체가 할당된 것 외에는 일반 변수와 다를 바 없다.
- 따라서 스코프를 “변수를 검색할 때 사용되는 규칙”이라고 표현하기 보다는 `"식별자를 검색하는 규칙"` 이라고 표현하는 편이 좀 더 적합하다.
